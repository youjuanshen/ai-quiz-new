<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å£è¯­é¢è¯•</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { font-family: 'Comic Sans MS', sans-serif; background: #e3f2fd; padding: 20px; color: #333; }
        .home-link { position: fixed; top: 15px; left: 15px; z-index: 1000; background-color: #607d8b; color: white; text-decoration: none; padding: 8px 15px; border-radius: 20px; font-size: 14px; font-weight: bold; }
        .container { max-width: 600px; margin: 0 auto; padding-top: 40px; }
        .welcome-card { background: white; border-radius: 20px; padding: 30px; margin: 0 auto; max-width: 500px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); border: 4px solid #fff; text-align: center; }
        select { width: 100%; padding: 12px; font-size: 16px; border: 2px solid #ddd; margin-bottom: 20px; border-radius: 10px; }
        #startButton { background: #0288d1; color: white; border: none; padding: 12px 40px; border-radius: 30px; font-size: 18px; cursor: pointer; width: 100%; }
        #startButton:disabled { background: #ccc; }
        
        .question-page { background: white; border-radius: 16px; padding: 20px; margin-bottom: 20px; border-left: 6px solid #29b6f6; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .score-buttons { display: flex; gap: 5px; margin-top: 15px; }
        .score-btn { flex: 1; padding: 12px 0; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; }
        .s5{background:#4caf50}.s4{background:#8bc34a}.s3{background:#ffc107;color:#333}.s2{background:#ff9800}.s1{background:#f44336}
        .feedback { display: none; background: #e8f5e9; color: #2e7d32; padding: 10px; border-radius: 8px; text-align: center; margin-top: 10px; font-weight: bold; }
        .img-box { text-align: center; margin: 15px 0; }
        .img-box img { max-width: 100%; max-height: 250px; border-radius: 8px; }
    </style>
</head>
<body>

<a href="index.html" class="home-link">ğŸ  è¿”å›å¤§å…</a>

<div class="container">
    <div id="coverPage">
        <div style="font-size:60px;text-align:center;margin-bottom:10px">ğŸ—£ï¸</div>
        <h1 style="text-align:center;color:#0288d1">å£è¯­é¢è¯• (è€å¸ˆç«¯)</h1>
        
        <div class="welcome-card">
            <div style="text-align:left;font-weight:bold;margin-bottom:10px">ğŸ—ºï¸ é€‰æ‹©å…³å¡</div>
            <select id="quizSelector" onchange="loadSelectedQuiz()">
                <option value="" disabled selected>-- è¯·é€‰æ‹©å•å…ƒ --</option>
                </select>
            
            <div id="statusBox" style="display:none;color:#999;margin-bottom:10px">â³ è¯»å–ä¸­...</div>

            <div style="text-align:left;font-weight:bold;margin-bottom:10px">ğŸ‘‹ é€‰æ‹©è€ƒç”Ÿ</div>
            <select id="studentSelector" onchange="checkStartReady()" disabled>
                <option value="" disabled selected>-- (è¯·å…ˆé€‰è¯¾) --</option>
            </select>
            
            <button id="startButton" disabled onclick="startQuiz()">ğŸš€ å¼€å§‹é¢è¯•</button>
        </div>
    </div>

    <div id="quizInterface" style="display:none">
        <div style="background:white;padding:10px;position:sticky;top:0;z-index:99;border-bottom:1px solid #eee;display:flex;justify-content:space-between">
            <span>ğŸ‘¤ è€ƒç”Ÿ: <span id="studentDisplay" style="color:#0288d1;font-weight:bold"></span></span>
            <button onclick="location.reload()" style="border:none;background:#eee;padding:5px 10px;border-radius:10px">é‡ç½®</button>
        </div>
        <div id="quizContainer" style="margin-top:20px"></div>
        <div style="text-align:center;font-weight:bold;margin-top:20px;font-size:20px;background:white;padding:15px;position:fixed;bottom:0;left:0;right:0;border-top:1px solid #eee">
            ğŸŒŸ æ€»åˆ†: <span id="totalScore">0</span>
        </div>
        <div style="height:80px"></div>
    </div>
</div>

<script>
    const SPEAKING_MENU = [
        { label: "Unit 1 Lesson 1: Nice to meet you", path: "data/speaking/u1_l1.js" }
        // æœªæ¥æ·»åŠ æ›´å¤š...
    ];

    const STUDENT_LIST = [
        "1. å¼ å®‡è±ª", "2. å¼ ä½³å¯’", "3. å¼ ç¿æ¸Š", "4. å¼ ç¾½éŸ¬", "5. å¼ ç¾èŒ¹",
        "6. å¼ å˜‰é’¦", "7. å¢æ¢¦å©·", "8. å¼ æ‚¦è±", "9. å¼ è¯­æ¶µ", "10. å¼ è‹±è±ª",
        "11. å¼ å¿—é¹", "12. å¼ æ™ºæ°", "13. å¼ æ¢“å©·", "14. å¼ å“çª", "15. å¼ è¯ºä¾",
        "16. å¼ é›¨æ³½", "17. å¼ ä¾å½¤", "18. å¼ è‰ºæ¥ ", "19. å¼ æ€å½¤", "20. å¼ å­è±ª",
        "21. å¼ æ¢“äº¦", "22. å¼ çš“é‘«", "23. å¼ é›¨æ¬£", "24. å¼ å¦‚æ¬£", "25. å¼ æŸæ¶µ",
        "26. å¼ æ¢“çº¯", "27. å¼ æ³½é‘«"
    ];

    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxc8c4prsZZLY9vp-te4gH5twQNO1A8Ek3yROTNZeNs-7YhL60UojvMsQoceJUZ7LUP/exec";

    let currentQuizData = null;
    let totalScore = 0;

    window.onload = function() {
        const sel = document.getElementById('quizSelector');
        SPEAKING_MENU.forEach(i => {
            let opt = document.createElement('option');
            opt.value = i.path; opt.innerText = i.label;
            sel.appendChild(opt);
        });
    };

    function loadSelectedQuiz() {
        const path = document.getElementById('quizSelector').value;
        if(!path) return;
        
        document.getElementById('statusBox').style.display = 'block';
        currentQuizData = null; // Reset

        const script = document.createElement('script');
        script.src = path;
        script.onload = () => {
            if(!currentQuizData) { alert("æ–‡ä»¶æ ¼å¼é”™è¯¯ (æœªåŒ…å« window.LOAD_QUIZ)"); return; }
            document.getElementById('statusBox').innerText = "âœ… " + currentQuizData.title;
            populateStudents();
            document.getElementById('studentSelector').disabled = false;
        };
        script.onerror = () => { alert("æ‰¾ä¸åˆ°æ–‡ä»¶: " + path); };
        document.body.appendChild(script);
    }

    window.LOAD_QUIZ = function(data) { currentQuizData = data; };

    function populateStudents() {
        const sel = document.getElementById('studentSelector');
        sel.innerHTML = '<option value="" disabled selected>-- é€‰æ‹©å§“å --</option>';
        STUDENT_LIST.forEach(s => {
            let opt = document.createElement('option');
            opt.value = s; opt.innerText = s;
            sel.appendChild(opt);
        });
    }

    function checkStartReady() {
        if(document.getElementById('studentSelector').value) document.getElementById('startButton').disabled = false;
    }

    function startQuiz() {
        if(!currentQuizData || !currentQuizData.questions) { alert("é¢˜ç›®æ•°æ®ä¸ºç©ºï¼"); return; }
        
        document.getElementById('coverPage').style.display = 'none';
        document.getElementById('quizInterface').style.display = 'block';
        document.getElementById('studentDisplay').innerText = document.getElementById('studentSelector').value;
        totalScore = 0;
        renderQuestions();
    }

    function renderQuestions() {
        const con = document.getElementById('quizContainer');
        con.innerHTML = '';
        
        currentQuizData.questions.forEach((q, i) => {
            const div = document.createElement('div');
            div.className = 'question-page';
            div.id = `card-${i}`;
            
            let html = `<div style="background:#29b6f6;color:white;padding:2px 8px;border-radius:10px;display:inline-block;font-size:12px;font-weight:bold;margin-bottom:10px">Q${q.qNum}</div>`;
            html += `<div style="font-size:18px;font-weight:bold;margin-bottom:15px">${q.text}</div>`;
            
            if(q.imageKey && currentQuizData.images) {
                let src = currentQuizData.images[q.imageKey];
                if(src && !src.startsWith('http') && !src.startsWith('img/')) src = 'img/' + src;
                if(src) html += `<div class="img-box"><img src="${src}"></div>`;
            }

            html += `<div style="background:#fff3e0;padding:10px;border-radius:5px;margin:10px 0;color:#e65100">ğŸ’¡ å‚è€ƒ: ${q.guide}</div>`;
            
            html += `<div id="action-${i}" class="score-buttons">
                <button onclick="rate(${i},5)" class="score-btn s5">ğŸ¤© 5</button>
                <button onclick="rate(${i},4)" class="score-btn s4">ğŸ˜ƒ 4</button>
                <button onclick="rate(${i},3)" class="score-btn s3">ğŸ¤” 3</button>
                <button onclick="rate(${i},2)" class="score-btn s2">ğŸ˜Ÿ 2</button>
                <button onclick="rate(${i},1)" class="score-btn s1">ğŸ˜¶ 1</button>
            </div><div id="fb-${i}" class="feedback"></div>`;

            div.innerHTML = html;
            con.appendChild(div);
        });
    }

    window.rate = function(i, s) {
        document.getElementById(`action-${i}`).style.display = 'none';
        const fb = document.getElementById(`fb-${i}`);
        fb.style.display = 'block';
        fb.innerText = `âœ… å¾—åˆ†: ${s}`;
        totalScore += s;
        document.getElementById('totalScore').innerText = totalScore;

        const next = document.getElementById(`card-${i+1}`);
        if(next) setTimeout(()=>next.scrollIntoView({behavior:'smooth', block:'center'}), 300);

        if(i === currentQuizData.questions.length - 1) {
            // æœ€åä¸€é¢˜ä¸Šä¼ 
            const payload = {
                studentName: document.getElementById('studentSelector').value,
                examType: "Speaking",
                lessonTitle: currentQuizData.title,
                score: totalScore,
                duration: "N/A",
                details: "Teacher Rated"
            };
            fetch(GOOGLE_SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) });
            alert("é¢è¯•ç»“æŸï¼æˆç»©å·²ä¸Šä¼ ã€‚");
        }
    }
</script>
</body>
</html>
