<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Unit 1 Lesson 4 – Have a good day!</title>

<!-- 基本防缓存（老师访问时建议带 ?v=数字） -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<style>
    body {
        margin: 0;
        font-family: "Arial Rounded MT Bold", "微软雅黑", sans-serif;
        background: linear-gradient(#f4f9ff, #e3f2ff);
    }
    h1, h2, h3 {
        margin: 0;
        text-align: center;
    }
    #cover {
        text-align: center;
        padding: 40px 20px 30px;
    }
    .title-main {
        font-size: 2rem;
        color: #2a6bd4;
        font-weight: 800;
        text-shadow: 1px 1px 3px #fff;
    }
    .title-sub {
        font-size: 1.5rem;
        color: #ff9800;
        margin-top: 6px;
    }
    .title-info {
        font-size: 1.1rem;
        color: #555;
        margin-top: 10px;
    }
    .select-box {
        margin-top: 35px;
    }
    select {
        width: 80%;
        max-width: 360px;
        height: 44px;
        font-size: 1rem;
        border-radius: 10px;
        border: 2px solid #7ab8ff;
        padding-left: 10px;
        outline: none;
    }
    #startBtn {
        margin-top: 30px;
        width: 80%;
        max-width: 260px;
        height: 50px;
        background: #ffcf4a;
        border: none;
        border-radius: 16px;
        font-size: 1.2rem;
        font-weight: bold;
        color: #444;
        box-shadow: 0 5px 0 #e2b93b;
        cursor: pointer;
    }
    #startBtn:active {
        transform: translateY(3px);
        box-shadow: 0 2px 0 #e2b93b;
    }

    /* 考试页整体 */
    #examPage {
        display: none;
        max-width: 900px;
        margin: 0 auto;
        padding: 10px 15px 40px;
        background: #ffffffdd;
        border-radius: 18px 18px 0 0;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.08);
    }

    .timer-box {
        text-align: center;
        margin-top: 10px;
        margin-bottom: 10px;
    }
    .timer-label {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 20px;
        background: #fff7d6;
        font-size: 1.2rem;
        font-weight: bold;
        color: #d9534f;
    }

    .section-title {
        font-size: 1.3rem;
        margin: 15px 0 10px;
        color: #333;
        text-align: left;
    }

    /* 听力部分 */
    #listening-section {
        margin-top: 10px;
    }
    #listening-progress {
        font-size: 1rem;
        margin-bottom: 8px;
        color: #555;
    }
    .question {
        display: none; /* 一题一屏，JS 控制显示 */
        margin-top: 10px;
        padding: 15px;
        border-radius: 12px;
        background: #f8fbff;
        border: 1px solid #dde8ff;
    }
    .q-text {
        font-size: 1.05rem;
        margin-bottom: 10px;
    }

    /* 图片题布局 */
    .picture-row {
        display: flex;
        justify-content: space-around;
        gap: 8px;
        margin-top: 8px;
        flex-wrap: wrap;
    }
    .picture-option {
        flex: 1;
        min-width: 90px;
        max-width: 180px;
        text-align: center;
    }
    .picture-option label {
        display: block;
        cursor: pointer;
    }
    .picture-box {
        border-radius: 12px;
        background: #fff;
        border: 2px solid #c2d9ff;
        padding: 5px;
    }
    .option-caption {
        margin-top: 4px;
        font-size: 0.9rem;
    }

    .options-block {
        margin-top: 10px;
        text-align: left;
        font-size: 1rem;
    }
    .options-block label {
        display: block;
        margin-bottom: 4px;
        cursor: pointer;
    }

    #listening-done {
        display: none;
        margin-top: 10px;
        padding: 10px;
        background: #e8f8e8;
        border-radius: 10px;
        font-size: 0.95rem;
        color: #2f7d32;
    }

    /* 阅读 / 写作占位 */
    #reading-section, #writing-section {
        margin-top: 25px;
        text-align: left;
        font-size: 0.98rem;
        padding: 10px;
        border-radius: 12px;
        background: #f9f9f9;
        border: 1px dashed #ccc;
    }

    @media (max-width: 480px) {
        .title-main { font-size: 1.7rem; }
        .title-sub { font-size: 1.3rem; }
        .title-info { font-size: 0.95rem; }
    }
</style>
</head>

<body>

<!-- 封面 -->
<div id="cover">
    <h1 class="title-main">Unit 1 Lesson 4</h1>
    <h2 class="title-sub">Have a good day!</h2>
    <div class="title-info">听力 + 阅读 + 写作 ｜ 总分 75 分 ｜ 用时 9 分钟</div>

    <div class="select-box">
        <div style="font-size:1rem;margin-bottom:8px;">请选择你的学号 + 姓名：</div>
        <select id="studentSelect">
            <option value="">请选择学生</option>
            <option value="01 张宇豪">01 张宇豪</option>
            <option value="02 张佳寒">02 张佳寒</option>
            <option value="03 张睿渊">03 张睿渊</option>
            <option value="04 张羽韬">04 张羽韬</option>
            <option value="05 张美茹">05 张美茹</option>
            <option value="06 张嘉钦">06 张嘉钦</option>
            <option value="07 卢梦婷">07 卢梦婷</option>
            <option value="08 张悦萱">08 张悦萱</option>
            <option value="09 张语涵">09 张语涵</option>
            <option value="10 张英豪">10 张英豪</option>
            <option value="11 张志鹏">11 张志鹏</option>
            <option value="12 张智杰">12 张智杰</option>
            <option value="13 张梓婷">13 张梓婷</option>
            <option value="14 张品琪">14 张品琪</option>
            <option value="15 张诺依">15 张诺依</option>
            <option value="16 张雨泽">16 张雨泽</option>
            <option value="17 张依彤">17 张依彤</option>
            <option value="18 张艺楠">18 张艺楠</option>
            <option value="19 张思彤">19 张思彤</option>
            <option value="20 张子豪">20 张子豪</option>
            <option value="21 张梓亦">21 张梓亦</option>
            <option value="22 张皓鑫">22 张皓鑫</option>
            <option value="23 张雨欣">23 张雨欣</option>
            <option value="24 张如欣">24 张如欣</option>
            <option value="25 张柏涵">25 张柏涵</option>
            <option value="26 张梓纯">26 张梓纯</option>
            <option value="27 张泽鑫">27 张泽鑫</option>
        </select>
    </div>

    <button id="startBtn">开始答题</button>
</div>

<!-- 考试页面 -->
<div id="examPage">
    <div class="timer-box">
        <span class="timer-label">剩余时间：<span id="timerText">09:00</span></span>
    </div>

    <h3 class="section-title">Part 1 – Listening 听力（25 分）</h3>
    <div id="listening-section">
        <div id="listening-progress">Question <span id="qNumber">1</span> / 5</div>

        <!-- Q1 听音选图 Good afternoon. -->
        <div class="question" id="q1">
            <div class="q-text"><strong>Q1. 听句子，选出正确的图片。（Good afternoon.）</strong></div>
            <div class="picture-row">
                <!-- 早晨 -->
                <div class="picture-option">
                    <label>
                        <div class="picture-box">
                            <!-- 简单卡通早晨 SVG -->
                            <svg width="100%" viewBox="0 0 100 80">
                                <rect x="0" y="40" width="100" height="40" fill="#8fd3fe"></rect>
                                <rect x="0" y="40" width="100" height="10" fill="#6ac36a"></rect>
                                <circle cx="20" cy="40" r="12" fill="#ffd54f"></circle>
                            </svg>
                        </div>
                        <div class="option-caption">
                            <input type="radio" name="L1" onchange="handleAnswer(0)"> 早晨
                        </div>
                    </label>
                </div>
                <!-- 下午（正确） -->
                <div class="picture-option">
                    <label>
                        <div class="picture-box">
                            <!-- 卡通下午 SVG -->
                            <svg width="100%" viewBox="0 0 100 80">
                                <rect x="0" y="40" width="100" height="40" fill="#ffecb3"></rect>
                                <rect x="0" y="40" width="100" height="10" fill="#81c784"></rect>
                                <circle cx="70" cy="30" r="14" fill="#ffb300"></circle>
                            </svg>
                        </div>
                        <div class="option-caption">
                            <input type="radio" name="L1" onchange="handleAnswer(0)"> 下午
                        </div>
                    </label>
                </div>
                <!-- 晚上 -->
                <div class="picture-option">
                    <label>
                        <div class="picture-box">
                            <!-- 卡通晚上 SVG -->
                            <svg width="100%" viewBox="0 0 100 80">
                                <rect x="0" y="0" width="100" height="80" fill="#1a237e"></rect>
                                <circle cx="25" cy="20" r="10" fill="#fff59d"></circle>
                                <circle cx="80" cy="15" r="2" fill="#fff"></circle>
                                <circle cx="70" cy="28" r="2" fill="#fff"></circle>
                                <circle cx="60" cy="12" r="2" fill="#fff"></circle>
                            </svg>
                        </div>
                        <div class="option-caption">
                            <input type="radio" name="L1" onchange="handleAnswer(0)"> 晚上
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <!-- Q2 How are you? 选正确回应 -->
        <div class="question" id="q2">
            <div class="q-text"><strong>Q2. 听句子，选出正确的回答。</strong><br>（How are you?）</div>
            <div class="options-block">
                <label><input type="radio" name="L2" onchange="handleAnswer(1)"> A. I’m fine, thank you.</label>
                <label><input type="radio" name="L2" onchange="handleAnswer(1)"> B. Goodbye.</label>
                <label><input type="radio" name="L2" onchange="handleAnswer(1)"> C. Good morning.</label>
            </div>
        </div>

        <!-- Q3 Good morning. T/F 判断 -->
        <div class="question" id="q3">
            <div class="q-text"><strong>Q3. 听句子，看图判断对错。（Good morning.）</strong></div>
            <div style="max-width:260px;margin:0 auto;">
                <div class="picture-box">
                    <!-- 用早晨卡通图表示“早上” -->
                    <svg width="100%" viewBox="0 0 100 80">
                        <rect x="0" y="40" width="100" height="40" fill="#bbdefb"></rect>
                        <rect x="0" y="40" width="100" height="10" fill="#66bb6a"></rect>
                        <circle cx="20" cy="35" r="13" fill="#ffeb3b"></circle>
                        <circle cx="55" cy="18" r="6" fill="#fff"></circle>
                        <circle cx="65" cy="20" r="5" fill="#fff"></circle>
                    </svg>
                </div>
            </div>
            <div class="options-block">
                <label><input type="radio" name="L3" onchange="handleAnswer(2)"> T. 相符</label>
                <label><input type="radio" name="L3" onchange="handleAnswer(2)"> F. 不相符</label>
            </div>
        </div>

        <!-- Q4 How are you? 选不同干扰 -->
        <div class="question" id="q4">
            <div class="q-text"><strong>Q4. 再听一遍，选出最佳回答。</strong><br>（How are you?）</div>
            <div class="options-block">
                <label><input type="radio" name="L4" onchange="handleAnswer(3)"> A. I’m fine, thank you.</label>
                <label><input type="radio" name="L4" onchange="handleAnswer(3)"> B. Good afternoon.</label>
                <label><input type="radio" name="L4" onchange="handleAnswer(3)"> C. I’m LiLi.</label>
            </div>
        </div>

        <!-- Q5 Hello. 连线句子（这里用单选代替连线，方便电子操作） -->
        <div class="question" id="q5">
            <div class="q-text"><strong>Q5. 听句子，把它和正确的句子连起来。</strong><br>（Hello.）</div>
            <div class="options-block">
                <label><input type="radio" name="L5" onchange="handleAnswer(4)"> Hello.</label>
                <label><input type="radio" name="L5" onchange="handleAnswer(4)"> Good morning.</label>
                <label><input type="radio" name="L5" onchange="handleAnswer(4)"> Good afternoon.</label>
            </div>
        </div>

        <div id="listening-done">
            听力部分结束啦，请继续完成阅读和写作部分。
        </div>
    </div>

    <!-- 阅读 / 写作 占位区，老师之后可以继续补充 -->
    <h3 class="section-title">Part 2 – Reading 阅读（25 分）</h3>
    <div id="reading-section">
        （这里可以放图文匹配 / 句子判断等阅读题，稍后我们可以再一起设计。）
    </div>

    <h3 class="section-title">Part 3 – Writing 写作（25 分）</h3>
    <div id="writing-section">
        （这里可以放拖拽拼句 / 看图写句等写作题，稍后我们可以加上。）
    </div>
</div>

<script>
let totalSeconds = 9 * 60;
let timerId = null;

// 听力数据（按顺序）
const listeningData = [
    { id: "q1", text: "Good afternoon." },
    { id: "q2", text: "How are you?" },
    { id: "q3", text: "Good morning." },
    { id: "q4", text: "How are you?" },
    { id: "q5", text: "Hello." }
];
let currentIndex = 0;
let answeredFlags = new Array(listeningData.length).fill(false);

// 开始答题
document.getElementById("startBtn").addEventListener("click", () => {
    const sel = document.getElementById("studentSelect").value;
    if (!sel) {
        alert("请先选择学生姓名！");
        return;
    }

    document.getElementById("cover").style.display = "none";
    document.getElementById("examPage").style.display = "block";

    startTimer();
    startListeningSequence();
});

// 计时器
function startTimer() {
    updateTimerDisplay();
    timerId = setInterval(() => {
        totalSeconds--;
        if (totalSeconds < 0) {
            clearInterval(timerId);
            alert("时间到！请停止作答。");
            return;
        }
        updateTimerDisplay();
    }, 1000);
}
function updateTimerDisplay() {
    let m = Math.floor(totalSeconds / 60);
    let s = totalSeconds % 60;
    document.getElementById("timerText").textContent =
        String(m).padStart(2,"0") + ":" + String(s).padStart(2,"0");
}

// 启动听力流程
function startListeningSequence() {
    currentIndex = 0;
    answeredFlags.fill(false);
    showQuestion(listeningData[currentIndex].id);
    playSentenceTwice(listeningData[currentIndex].text);
    updateProgress();
}

// 显示当前题，隐藏其他题
function showQuestion(qid) {
    const qs = document.querySelectorAll(".question");
    qs.forEach(q => q.style.display = "none");
    const el = document.getElementById(qid);
    if (el) el.style.display = "block";
    // 回到页面顶部，方便在手机上看
    window.scrollTo({ top: 0, behavior: "smooth" });
}

function updateProgress() {
    document.getElementById("qNumber").textContent = (currentIndex + 1);
}

// 学生选中答案时触发
function handleAnswer(index) {
    if (index !== currentIndex) return;        // 避免乱点别题
    if (answeredFlags[index]) return;         // 已经答过就不再重复
    answeredFlags[index] = true;

    // 稍等一下再跳转，给学生一点确认时间
    setTimeout(() => {
        moveToNextQuestion();
    }, 500);
}

// 跳转下一题或结束听力
function moveToNextQuestion() {
    if (currentIndex < listeningData.length - 1) {
        currentIndex++;
        showQuestion(listeningData[currentIndex].id);
        updateProgress();
        // 取消之前的语音，再播放下一句
        if (speechSynthesis.speaking) speechSynthesis.cancel();
        playSentenceTwice(listeningData[currentIndex].text);
    } else {
        // 听力结束
        if (speechSynthesis.speaking) speechSynthesis.cancel();
        document.getElementById("listening-done").style.display = "block";
        document.getElementById("reading-section").scrollIntoView({ behavior: "smooth" });
    }
}

// 选女生、正常语速的语音（尽量挑女声，没有就默认）
function pickFemaleVoice() {
    const voices = speechSynthesis.getVoices();
    if (!voices || voices.length === 0) return null;
    let female = voices.find(v => /female|woman|girl|zira|xiaoyan|Google UK English Female/i.test(
        (v.name || "") + (v.voiceURI || "") + (v.lang || "")
    ));
    return female || voices[0];
}

// 播放句子两遍
function playSentenceTwice(text) {
    if (!text) return;
    if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
    }

    const voice = pickFemaleVoice();
    const u1 = new SpeechSynthesisUtterance(text);
    const u2 = new SpeechSynthesisUtterance(text);

    [u1, u2].forEach(u => {
        u.rate = 1.0;  // 正常语速
        u.pitch = 1.0;
        if (voice) u.voice = voice;
    });

    speechSynthesis.speak(u1);
    u1.onend = () => {
        setTimeout(() => {
            speechSynthesis.speak(u2);
        }, 800);  // 两遍之间停顿 0.8 秒
    };
}

// 某些浏览器需要先触发一次 getVoices
speechSynthesis.onvoiceschanged = () => {
    pickFemaleVoice();
};
</script>

</body>
</html>
