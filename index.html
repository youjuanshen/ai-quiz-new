<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>三年级上 U1 L4 Quiz - Listening & Reading & Writing</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
      line-height: 1.6;
    }
    h1, h2, h3 {
      margin-top: 1.2em;
      margin-bottom: 0.4em;
    }
    .top-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      margin-bottom: 16px;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
    label {
      margin-right: 4px;
    }
    select {
      padding: 4px 8px;
    }
    button {
      padding: 6px 12px;
      cursor: pointer;
    }
    #timer {
      font-weight: bold;
      font-size: 1.1em;
    }
    fieldset {
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 16px;
      padding: 10px 14px;
    }
    legend {
      font-weight: bold;
      padding: 0 6px;
    }
    .question {
      margin-bottom: 10px;
      padding-bottom: 6px;
      border-bottom: 1px dashed #eee;
    }
    .question:last-child {
      border-bottom: none;
    }
    .play-btn {
      margin-right: 8px;
    }

    /* 拖拽题样式：词块 + 方格 */
    .drag-question {
      margin-bottom: 12px;
    }
    .word-bank {
      min-height: 36px;
      border: 1px dashed #ccc;
      border-radius: 6px;
      padding: 6px;
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }
    .word {
      padding: 4px 8px;
      border: 1px solid #aaa;
      border-radius: 4px;
      background: #f7f7f7;
      cursor: move;
      user-select: none;
    }
    .drop-row {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .drop-slot {
      width: 80px;
      min-height: 36px;
      border: 1px dashed #ccc;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fafafa;
    }
    .drop-slot.over {
      border-color: #666;
    }

    #result-box {
      margin-top: 16px;
      padding: 10px 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      display: none;
    }
    #result-text {
      font-weight: bold;
    }
    .note {
      font-size: 0.9em;
      color: #555;
    }

    /* 封面页布局 */
    #cover-page {
      margin-top: 24px;
    }
    #cover-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      margin-top: 12px;
    }
  </style>
</head>
<body>
  <!-- 封面页 -->
  <div id="cover-page">
    <h1>三年级上 U1 L4 Quiz</h1>
    <p class="note">
      模块：Listening + Reading + Writing（共 15 题，建议每题 5 分，总分 75 分）<br>
      说明：本次测验限时 <strong>9 分钟</strong>，进入答题界面后开始倒计时。
    </p>

    <div id="cover-card">
      <div style="margin-bottom: 12px;">
        <label for="studentSelect">学生姓名：</label>
        <select id="studentSelect">
          <option value="" selected disabled>请选择姓名</option>
          <!-- 学生名单 -->
          <option value="01">01张宇豪</option>
          <option value="02">02张佳寒</option>
          <option value="03">03张睿渊</option>
          <option value="04">04张羽韬</option>
          <option value="05">05张美茹</option>
          <option value="06">06张嘉钦</option>
          <option value="07">07卢梦婷</option>
          <option value="08">08张悦萱</option>
          <option value="09">09张语涵</option>
          <option value="10">10张英豪</option>
          <option value="11">11张志鹏</option>
          <option value="12">12张智杰</option>
          <option value="13">13张梓婷</option>
          <option value="14">14张品琪</option>
          <option value="15">15张诺依</option>
          <option value="16">16张雨泽</option>
          <option value="17">17张依彤</option>
          <option value="18">18张艺楠</option>
          <option value="19">19张思彤</option>
          <option value="20">20张子豪</option>
          <option value="21">21张梓亦</option>
          <option value="22">22张皓鑫</option>
          <option value="23">23张雨欣</option>
          <option value="24">24张如欣</option>
          <option value="25">25张柏涵</option>
          <option value="26">26张梓纯</option>
          <option value="27">27张泽鑫</option>
        </select>
      </div>

      <p class="note">
        提示：点击“开始答题（9 分钟）”后会进入答题界面，并启动 9 分钟倒计时。<br>
        时间一旦开始，无法暂停或重置；时间到系统会自动提交答卷。
      </p>

      <button id="enterBtn">开始答题（9 分钟）</button>
    </div>
  </div>

  <!-- 答题页 -->
  <div id="quiz-page" style="display:none;">
    <div class="top-bar">
      <div>学生：<span id="studentNameDisplay"></span></div>
      <div>剩余时间：<span id="timer">09:00</span></div>
    </div>

    <!-- Listening 模块 -->
    <fieldset id="listeningSection" disabled>
      <legend>Part A Listening 听力（每题 5 分）</legend>

      <div class="question">
        <p>1. 听句子，选出你听到的问候语。</p>
        <button type="button" class="play-btn" data-tts="Good morning.">▶ 播放</button>
        <div>
          <label><input type="radio" name="L1" value="A"> Good morning.</label><br>
          <label><input type="radio" name="L1" value="B"> Good afternoon.</label><br>
          <label><input type="radio" name="L1" value="C"> Goodbye.</label>
        </div>
      </div>

      <div class="question">
        <p>2. 听句子，选出你听到的句子。</p>
        <button type="button" class="play-btn" data-tts="Good afternoon, Mom.">▶ 播放</button>
        <div>
          <label><input type="radio" name="L2" value="A"> Good morning, Mom.</label><br>
          <label><input type="radio" name="L2" value="B"> Goodbye, Mom.</label><br>
          <label><input type="radio" name="L2" value="C"> Good afternoon, Mom.</label>
        </div>
      </div>

      <div class="question">
        <p>3. 听句子，选出你听到的告别语。</p>
        <button type="button" class="play-btn" data-tts="Goodbye, Li Li.">▶ 播放</button>
        <div>
          <label><input type="radio" name="L3" value="A"> Good morning, Li Li.</label><br>
          <label><input type="radio" name="L3" value="B"> Goodbye, Li Li.</label><br>
          <label><input type="radio" name="L3" value="C"> Good afternoon, Li Li.</label>
        </div>
      </div>

      <div class="question">
        <p>4. 听句子，选出你听到的句子。</p>
        <button type="button" class="play-btn" data-tts="Have a good day!">▶ 播放</button>
        <div>
          <label><input type="radio" name="L4" value="A"> Good morning!</label><br>
          <label><input type="radio" name="L4" value="B"> How are you?</label><br>
          <label><input type="radio" name="L4" value="C"> Have a good day!</label>
        </div>
      </div>

      <div class="question">
        <p>5. 听一听，对话选答语。</p>
        <button type="button" class="play-btn" data-tts="Good afternoon, Li Li. How are you?">▶ 播放</button>
        <div>
          <label><input type="radio" name="L5" value="A"> I’m fine. Thank you.</label><br>
          <label><input type="radio" name="L5" value="B"> Goodbye.</label><br>
          <label><input type="radio" name="L5" value="C"> Have a good day.</label>
        </div>
      </div>
    </fieldset>

    <!-- Reading 模块 -->
    <fieldset id="readingSection" disabled>
      <legend>Part B Reading 阅读（每题 5 分）</legend>

      <div class="question">
        <p>6. 读一读，选出最佳答语。</p>
        <p>— Good morning, Mom.</p>
        <div>
          <label><input type="radio" name="R1" value="A"> Goodbye.</label><br>
          <label><input type="radio" name="R1" value="B"> Good morning.</label><br>
          <label><input type="radio" name="R1" value="C"> Good afternoon.</label>
        </div>
      </div>

      <div class="question">
        <p>7. 读一读，选出最佳答语。</p>
        <p>— Goodbye, Li Li.</p>
        <div>
          <label><input type="radio" name="R2" value="A"> Goodbye.</label><br>
          <label><input type="radio" name="R2" value="B"> Good morning.</label><br>
          <label><input type="radio" name="R2" value="C"> Have a good day.</label>
        </div>
      </div>

      <div class="question">
        <p>8. 读一读，选出最佳答语。</p>
        <p>— Have a good day, Li Li!</p>
        <div>
          <label><input type="radio" name="R3" value="A"> Thank you, you too!</label><br>
          <label><input type="radio" name="R3" value="B"> I’m fine.</label><br>
          <label><input type="radio" name="R3" value="C"> Good morning.</label>
        </div>
      </div>

      <div class="question">
        <p>9. 判断正误，正确写 T，错误写 F。</p>
        <p>“Goodbye.” 的意思是“再见”。</p>
        <label><input type="radio" name="R4" value="T"> T</label>
        <label><input type="radio" name="R4" value="F"> F</label>
      </div>

      <div class="question">
        <p>10. 判断正误，正确写 T，错误写 F。</p>
        <p>“Good afternoon.” 一般在下午说。</p>
        <label><input type="radio" name="R5" value="T"> T</label>
        <label><input type="radio" name="R5" value="F"> F</label>
      </div>
    </fieldset>

    <!-- Writing 模块 -->
    <fieldset id="writingSection" disabled>
      <legend>Part C Writing 写（拖拽 + 选字母填空，每题 5 分）</legend>

      <!-- 11：大小写识别 1 -->
      <div class="question drag-question" data-id="W1" data-answer="Good">
        <p>11. 看一看，把合适的单词拖到方块里。（句子开头要用大写字母。）</p>
        <p class="note">句子：______ morning.</p>
        <div class="drop-row" data-role="answer">
          <div class="drop-slot"></div>
        </div>
        <div class="word-bank">
          <span class="word" draggable="true">Good</span>
          <span class="word" draggable="true">good</span>
        </div>
      </div>

      <!-- 12：大小写识别 2 -->
      <div class="question drag-question" data-id="W2" data-answer="Good">
        <p>12. 看一看，把合适的单词拖到方块里。（句子开头要用大写字母。）</p>
        <p class="note">句子：______ afternoon.</p>
        <div class="drop-row" data-role="answer">
          <div class="drop-slot"></div>
        </div>
        <div class="word-bank">
          <span class="word" draggable="true">Good</span>
          <span class="word" draggable="true">good</span>
        </div>
      </div>

      <!-- 13 连词成句：Have a good day. -->
      <div class="question drag-question" data-id="W3" data-answer="Have a good day .">
        <p>13. 连词成句，把单词拖到上面方块里，排出正确顺序。</p>
        <div class="drop-row" data-role="answer">
          <div class="drop-slot"></div>
          <div class="drop-slot"></div>
          <div class="drop-slot"></div>
          <div class="drop-slot"></div>
          <div class="drop-slot"></div>
        </div>
        <div class="word-bank">
          <span class="word" draggable="true">good</span>
          <span class="word" draggable="true">Have</span>
          <span class="word" draggable="true">day</span>
          <span class="word" draggable="true">a</span>
          <span class="word" draggable="true">.</span>
        </div>
        <p class="note">（系统只检查顺序，不再额外扣大小写和标点。）</p>
      </div>

      <!-- 14 选字母填空：good -->
      <div class="question" data-id="W4">
        <p>14. 选字母填空，补全单词。</p>
        <p>g__d morning.</p>
        <div>
          <label><input type="radio" name="W4" value="A"> a a</label><br>
          <label><input type="radio" name="W4" value="B"> o o</label><br>
          <label><input type="radio" name="W4" value="C"> e e</label>
        </div>
      </div>

      <!-- 15 选字母填空：afternoon -->
      <div class="question" data-id="W5">
        <p>15. 选字母填空，补全单词。</p>
        <p>Good aftern___n.</p>
        <div>
          <label><input type="radio" name="W5" value="A"> o o</label><br>
          <label><input type="radio" name="W5" value="B"> e e</label><br>
          <label><input type="radio" name="W5" value="C"> a a</label>
        </div>
      </div>
    </fieldset>

    <!-- 提交按钮 -->
    <div style="margin-top: 16px;">
      <button id="submitBtn" disabled>提交答卷</button>
    </div>

    <!-- 结果区域 -->
    <div id="result-box">
      <div id="result-text"></div>
      <div id="result-detail" class="note"></div>
    </div>
  </div>

  <script>
    // ========= 全局变量 =========
    let timer = null;
    let timeLeft = 540; // 9 分钟
    let quizStarted = false;
    let quizFinished = false;

    // 正确答案（每题 5 分）
    const listeningAnswers = {
      L1: "A",
      L2: "C",
      L3: "B",
      L4: "C",
      L5: "A"
    };

    const readingAnswers = {
      R1: "B",
      R2: "A",
      R3: "A",
      R4: "T",
      R5: "T"
    };

    const writingChoiceAnswers = {
      W4: "B", // g oo d
      W5: "A"  // aftern oo n
    };

    // ========= 倒计时相关 =========
    function updateTimerDisplay() {
      const minutes = String(Math.floor(timeLeft / 60)).padStart(2, "0");
      const seconds = String(timeLeft % 60).padStart(2, "0");
      const timerSpan = document.getElementById("timer");
      if (timerSpan) {
        timerSpan.textContent = `${minutes}:${seconds}`;
      }
    }

    function startCountdown() {
      updateTimerDisplay();
      timer = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) {
          timeLeft = 0;
          updateTimerDisplay();
          clearInterval(timer);
          if (!quizFinished) {
            alert("时间到，系统将自动提交答卷。");
            submitAnswers();
          }
        } else {
          updateTimerDisplay();
        }
      }, 1000);
    }

    // ========= 语音朗读（互斥播放） =========
    function playTTS(text) {
      if (!window.speechSynthesis) {
        alert("当前浏览器不支持朗读功能。");
        return;
      }
      window.speechSynthesis.cancel();
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = "en-US";
      window.speechSynthesis.speak(utter);
    }

    // ========= 拖拽题相关（单词 ↔ 方格） =========
    function initDragAndDrop() {
      const words = document.querySelectorAll(".word");
      words.forEach(word => {
        word.addEventListener("dragstart", (e) => {
          e.dataTransfer.setData("text/plain", "drag-word");
          e.dataTransfer.effectAllowed = "move";
          word.classList.add("dragging");
        });
        word.addEventListener("dragend", () => {
          word.classList.remove("dragging");
        });
      });

      // 方格：只允许放一个单词
      const slots = document.querySelectorAll(".drop-slot");
      slots.forEach(slot => {
        slot.addEventListener("dragover", (e) => {
          e.preventDefault();
          slot.classList.add("over");
        });
        slot.addEventListener("dragleave", () => {
          slot.classList.remove("over");
        });
        slot.addEventListener("drop", (e) => {
          e.preventDefault();
          slot.classList.remove("over");
          const dragging = document.querySelector(".word.dragging");
          if (!dragging) return;

          const question = slot.closest(".drag-question");
          const bank = question.querySelector(".word-bank");

          const existing = slot.querySelector(".word");
          if (existing && bank) {
            bank.appendChild(existing);
          }
          slot.appendChild(dragging);
        });
      });

      // 允许拖回单词库
      const wordBanks = document.querySelectorAll(".word-bank");
      wordBanks.forEach(bank => {
        bank.addEventListener("dragover", (e) => {
          e.preventDefault();
        });
        bank.addEventListener("drop", (e) => {
          e.preventDefault();
          const dragging = document.querySelector(".word.dragging");
          if (!dragging) return;
          bank.appendChild(dragging);
        });
      });
    }

    // 计算 3 道拖拽题得分
    function getDragSentenceScore() {
      let score = 0;
      const dragQuestions = document.querySelectorAll(".drag-question");
      dragQuestions.forEach(q => {
        const answerAttr = q.getAttribute("data-answer"); // 正确序列或单词
        const row = q.querySelector(".drop-row[data-role='answer']");
        const slots = Array.from(row.querySelectorAll(".drop-slot"));
        const chosenWords = slots.map(slot => {
          const w = slot.querySelector(".word");
          return w ? w.textContent.trim() : "";
        });
        const chosenStr = chosenWords.join(" ");
        if (chosenStr === answerAttr) {
          score += 5;
        }
      });
      return score;
    }

    // ========= 提交与评分 =========
    function submitAnswers() {
      quizFinished = true;
      const submitBtn = document.getElementById("submitBtn");
      if (submitBtn) submitBtn.disabled = true;
      if (window.speechSynthesis) {
        window.speechSynthesis.cancel();
      }

      let totalScore = 0;

      // Listening 5 题
      let listeningScore = 0;
      Object.keys(listeningAnswers).forEach(id => {
        const selected = document.querySelector(`input[name="${id}"]:checked`);
        if (selected && selected.value === listeningAnswers[id]) {
          listeningScore += 5;
        }
      });
      totalScore += listeningScore;

      // Reading 5 题
      let readingScore = 0;
      Object.keys(readingAnswers).forEach(id => {
        const selected = document.querySelector(`input[name="${id}"]:checked`);
        if (selected && selected.value === readingAnswers[id]) {
          readingScore += 5;
        }
      });
      totalScore += readingScore;

      // Writing 拖拽题 3 题
      const dragScore = getDragSentenceScore();
      totalScore += dragScore;

      // Writing 选字母填空 2 题
      let writingChoiceScore = 0;
      Object.keys(writingChoiceAnswers).forEach(id => {
        const selected = document.querySelector(`input[name="${id}"]:checked`);
        if (selected && selected.value === writingChoiceAnswers[id]) {
          writingChoiceScore += 5;
        }
      });
      totalScore += writingChoiceScore;

      const percent = Math.round(totalScore / 75 * 100);

      let levelText = "";
      if (percent >= 90) {
        levelText = "表现非常棒，可以自信使用这些问候和告别语了！";
      } else if (percent >= 75) {
        levelText = "整体很好，再多练几次就更熟练啦。";
      } else if (percent >= 60) {
        levelText = "基本达标，可以重点复习没把握的题目。";
      } else {
        levelText = "建议再做一遍题目，多听多读，会越来越好。";
      }

      const studentSelect = document.getElementById("studentSelect");
      const studentLabel = studentSelect && studentSelect.value
        ? studentSelect.options[studentSelect.selectedIndex].text
        : "(未选择学生)";

      const resultBox = document.getElementById("result-box");
      const resultText = document.getElementById("result-text");
      const resultDetail = document.getElementById("result-detail");

      resultText.textContent = `学生：${studentLabel} ｜ 总分：${totalScore} / 75 （${percent}%）`;
      resultDetail.innerHTML =
        `Listening：${listeningScore} 分；Reading：${readingScore} 分；Writing：${dragScore + writingChoiceScore} 分。<br>` +
        levelText;

      resultBox.style.display = "block";
    }

    // ========= 事件绑定 =========
    window.addEventListener("DOMContentLoaded", () => {
      initDragAndDrop();

      // TTS
      document.querySelectorAll(".play-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const text = btn.getAttribute("data-tts");
          playTTS(text);
        });
      });

      // 封面页「开始答题」
      document.getElementById("enterBtn").addEventListener("click", () => {
        if (quizStarted) return;

        const studentSelect = document.getElementById("studentSelect");
        if (!studentSelect.value) {
          alert("请先选择学生姓名，再开始答题。");
          return;
        }

        quizStarted = true;

        // 显示学生姓名到答题页顶部
        const label = studentSelect.options[studentSelect.selectedIndex].text;
        document.getElementById("studentNameDisplay").textContent = label;

        // 切换到答题页
        document.getElementById("cover-page").style.display = "none";
        document.getElementById("quiz-page").style.display = "block";

        // 启用题目和提交按钮
        document.getElementById("listeningSection").disabled = false;
        document.getElementById("readingSection").disabled = false;
        document.getElementById("writingSection").disabled = false;
        document.getElementById("submitBtn").disabled = false;

        // 开始倒计时
        startCountdown();
      });

      // 提交按钮
      document.getElementById("submitBtn").addEventListener("click", () => {
        if (!quizFinished) {
          if (timer) clearInterval(timer);
          submitAnswers();
        }
      });
    });
  </script>
</body>
</html>
