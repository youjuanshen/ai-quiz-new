<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¬”è¯•æŒ‘æˆ˜ (è¯Šæ–­æ¨¡å¼)</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { font-family: 'Comic Sans MS', sans-serif; background-color: #fff3e0; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; }
        .welcome-card { background: white; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 20px; }
        select, button { width: 100%; padding: 10px; margin: 5px 0; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; }
        #startButton { background: #4caf50; color: white; border: none; font-weight: bold; }
        
        /* ğŸ è°ƒè¯•æ—¥å¿—æ¡†æ ·å¼ */
        #debug-console {
            background: #000; color: #0f0; font-family: monospace; 
            padding: 10px; margin-top: 20px; border-radius: 5px; 
            font-size: 12px; white-space: pre-wrap; word-break: break-all;
            min-height: 100px; border: 2px solid #f00;
        }
    </style>
</head>
<body>

<a href="index.html" style="display:block;margin-bottom:10px;">ğŸ  è¿”å›å¤§å…</a>

<div class="container">
    <div id="coverPage">
        <h1>ğŸ“ ç¬”è¯•æŒ‘æˆ˜ (è¯Šæ–­ç‰ˆ)</h1>
        <div class="welcome-card">
            <label>1. é€‰æ‹©å…³å¡ï¼š</label>
            <select id="quizSelector" onchange="loadSelectedQuiz()">
                <option value="" disabled selected>-- è¯·é€‰æ‹© --</option>
                <optgroup label="Unit 1">
                    <option value="data/written/u1_l1.js">Unit 1 Lesson 1</option>
                </optgroup>
                <optgroup label="Unit 3">
                    <option value="data/written/u3_l1.js">Unit 3 Lesson 1</option>
                </optgroup>
            </select>
            
            <br><br>
            <label>2. é€‰æ‹©å§“åï¼š</label>
            <select id="studentSelector" disabled>
                <option value="">(ç­‰å¾…é¢˜ç›®åŠ è½½...)</option>
            </select>
            
            <button id="startButton" onclick="startQuiz()" disabled>ğŸš€ å¼€å§‹</button>
        </div>
    </div>

    <div id="quizContainer"></div>
</div>

<h3>ğŸ”§ ç³»ç»Ÿè¯Šæ–­æ—¥å¿—ï¼š</h3>
<div id="debug-console">ç­‰å¾…æ“ä½œ...</div>

<script>
    // 1. æ•è·æ‰€æœ‰é”™è¯¯å¹¶æ‰“å°åˆ°å±å¹•ä¸Š
    function log(msg, type='info') {
        const consoleBox = document.getElementById('debug-console');
        const time = new Date().toLocaleTimeString();
        const color = type === 'error' ? 'red' : '#0f0';
        consoleBox.innerHTML += `<div style="color:${color}">[${time}] ${msg}</div>`;
    }
    
    window.onerror = function(message, source, lineno, colno, error) {
        log(`âŒ å‘ç”Ÿé”™è¯¯: ${message}\næ–‡ä»¶: ${source}\nè¡Œå·: ${lineno}`, 'error');
    };

    // 2. é…ç½®
    let currentQuizData = null;
    const STUDENT_LIST = ["1. å¼ å®‡è±ª", "2. å¼ ä½³å¯’", "3. å¼ ç¿æ¸Š"]; // (ä¸ºäº†æµ‹è¯•å…ˆç®€å†™)

    // 3. åŠ è½½é€»è¾‘
    function loadSelectedQuiz() {
        const filePath = document.getElementById('quizSelector').value;
        log(`æ­£åœ¨å°è¯•åŠ è½½æ–‡ä»¶: ${filePath}...`);
        
        // æ¯æ¬¡åŠ è½½å‰æ¸…é™¤æ—§çš„
        const oldScript = document.getElementById('quiz-script');
        if(oldScript) oldScript.remove();

        const script = document.createElement('script');
        script.id = 'quiz-script';
        script.src = filePath;
        
        script.onload = () => {
            log("âœ… æ–‡ä»¶ä¸‹è½½æˆåŠŸï¼æ­£åœ¨è§£ææ•°æ®...");
            // æ£€æŸ¥æ•°æ®æ˜¯å¦çœŸçš„è¿›æ¥äº†
            if (!currentQuizData) {
                log("âŒ å¤±è´¥ï¼šæ–‡ä»¶åŠ è½½äº†ï¼Œä½† window.LOAD_QUIZ æ²¡æœ‰è¢«è°ƒç”¨ã€‚\nå¯èƒ½åŸå› ï¼šæ–‡ä»¶å†…å®¹æ ¼å¼ä¸å¯¹ã€‚", 'error');
            } else {
                log(`ğŸ‰ æˆåŠŸè¯»å–é¢˜ç›®: ${currentQuizData.title}`);
                log(`åŒ…å« ${currentQuizData.questions.length} é“é¢˜`);
                enableStudentSelect();
            }
        };
        
        script.onerror = () => {
            log(`âŒ åŠ è½½å¤±è´¥ (404 Not Found)\nè¯·æ£€æŸ¥ GitHub ä¸Šæ˜¯å¦å­˜åœ¨: ${filePath}\næ³¨æ„å¤§å°å†™ï¼`, 'error');
        };
        
        document.body.appendChild(script);
    }

    // 4. æ•°æ®æ¥æ”¶æ¥å£
    window.LOAD_QUIZ = function(data) {
        log("ğŸ“¦æ”¶åˆ°æ•°æ®åŒ…...");
        currentQuizData = data;
    };

    function enableStudentSelect() {
        const sel = document.getElementById('studentSelector');
        sel.innerHTML = '<option value="">-- é€‰æ‹©å§“å --</option>';
        STUDENT_LIST.forEach(s => {
            sel.innerHTML += `<option value="${s}">${s}</option>`;
        });
        sel.disabled = false;
        document.getElementById('startButton').disabled = false;
    }

    function startQuiz() {
        if(!currentQuizData) return log("é”™è¯¯ï¼šæ²¡æœ‰é¢˜ç›®æ•°æ®", 'error');
        
        // ç®€å•æ¸²æŸ“ç¬¬ä¸€é¢˜æ¥æµ‹è¯•
        const q1 = currentQuizData.questions[0];
        const container = document.getElementById('quizContainer');
        document.getElementById('coverPage').style.display = 'none';
        
        container.innerHTML = `
            <div style="background:white;padding:20px;border-radius:10px;">
                <h3>æµ‹è¯•æ˜¾ç¤ºç¬¬ä¸€é¢˜ï¼š</h3>
                <p>${q1.text}</p>
                <p>å…±æœ‰ ${currentQuizData.questions.length} é“é¢˜ã€‚</p>
                <button onclick="location.reload()">è¿”å›</button>
            </div>
        `;
        log("ğŸ–¥ï¸ è¿›å…¥ç­”é¢˜ç•Œé¢");
    }
</script>
</body>
</html>
